<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.jxc.mapper.PurchaseRequestMapper">
	
	<resultMap type="PurchaseRequest" id="purchaseRequestMap">
		<id property="purchaseRequestId" column="PurchaseRequest_id" />
		<result property="suppContact" column="SuppContact" />
		<result property="suppPhone" column="SuppPhone" />
		<result property="requestTime" column="RequestTime" />
		<result property="deptReviewTime" column="DeptReviewTime" />
		<result property="financialAuditTime" column="FinancialAuditTime" />
		<result property="remark" column="Remark" />
		<association property="employeeByRequestEmpId" column="RequestEmpId" javaType="Employee">
			<id column="RequestEmpId" property="empLoginName"/>
		</association>
		<association property="employeeByDeptReviewEmp" column="DeptReviewEmp" javaType="Employee">
			<id column="DeptReviewEmp" property="empLoginName"/>
		</association>
		<association property="reviewstatusByDeptReviewStatus" column="DeptReviewStatus" javaType="ReviewStatus">
			<id column="DeptReviewStatus" property="rsId"/>
			<result column="deptStatus" property="rsName"/>
		</association>
		<association property="employeeByFinancialAuditEmp" column="FinancialAuditEmp" javaType="Employee">
			<id column="FinancialAuditEmp" property="empLoginName"/>
		</association>
		<association property="reviewstatusByFinancialAuditStatus" column="FinancialAuditStatus" javaType="ReviewStatus">
			<id column="FinancialAuditStatus" property="rsId"/>
			<result column="finalStatus" property="rsName"/>
		</association>
		<association property="supplier" column="Supplier_id" javaType="Supplier">
			<id column="Supplier_id" property="supplierId"/>
			<result column="Supp_name" property="suppName"/>
		</association>
	</resultMap>
	
	<insert id="addPurchaseRequest" parameterType="PurchaseRequest">
		INSERT INTO PurchaseRequest(PurchaseRequest_id,
			RequestEmpId,RequestTime,Supplier_id,SuppContact,SuppPhone,Remark) 
		VALUES(#{pr.purchaseRequestId},#{pr.employeeByRequestEmpId.empLoginName},
			#{pr.requestTime},#{pr.supplier.supplierId},#{pr.SuppContact},#{pr.SuppPhone},#{pr.Remark});
	</insert>
	
	<select id="getPurchaseRequestByBlurry" resultMap="purchaseRequestMap">
		SELECT pr.*,su.Supp_name,rs.`RS_name` AS deptStatus,final.`RS_name` AS finalStatus
			FROM purchaseRequest pr
			LEFT JOIN supplier su 
			ON pr.`Supplier_id`= su.Supplier_id
			LEFT JOIN reviewstatus rs
			ON pr.`DeptReviewStatus`=rs.`RS_id`
			LEFT JOIN reviewstatus final
			ON pr.`FinancialAuditStatus`=final.`RS_id`
		<where>
			<if test="null!=empNo and ''!=empNo">
				AND pr.`RequestEmpId` LIKE CONCAT('%',#{empNo},'%')
			</if>
			<if test="null!=singleNo and ''!=singleNo">
				AND pr.`PurchaseRequest_id` LIKE CONCAT('%',#{singleNo},'%')
			</if>
			<if test="null!=suppName and ''!=suppName">
				AND su.Supp_name LIKE CONCAT('%',#{suppName},'%')
			</if>
		</where>
	</select>
		
</mapper>
